"use strict";var b=Object.create;var u=Object.defineProperty;var G=Object.getOwnPropertyDescriptor;var A=Object.getOwnPropertyNames;var C=Object.getPrototypeOf,E=Object.prototype.hasOwnProperty;var w=(e,o,s,t)=>{if(o&&typeof o=="object"||typeof o=="function")for(let n of A(o))!E.call(e,n)&&n!==s&&u(e,n,{get:()=>o[n],enumerable:!(t=G(o,n))||t.enumerable});return e};var f=(e,o,s)=>(s=e!=null?b(C(e)):{},w(o||!e||!e.__esModule?u(s,"default",{value:e,enumerable:!0}):s,e));var p=require("whatsapp-web.js"),M=f(require("qrcode-terminal"));var h=f(require("dotenv"));h.default.config();var l="\u{1F916} ",i={adminNumber:process.env.ADMIN_NUMBER||"",isDevelopment:process.env.NODE_ENV==="development",geminiApiKey:process.env.GEMINI_API_KEY||""},c={model:"gemini-1.5-flash",temperature:.7,topK:40,topP:.95,maxOutputTokens:1024};if(!i.adminNumber)throw new Error("ADMIN_NUMBER n\xE3o configurado no .env");if(!i.geminiApiKey)throw new Error("GEMINI_API_KEY n\xE3o configurada no .env");var v=require("@google/generative-ai");var m=class{constructor(){console.log("Inicializando servi\xE7o Gemini...");let o=new v.GoogleGenerativeAI(i.geminiApiKey);this.model=o.getGenerativeModel({model:c.model,generationConfig:{temperature:c.temperature,topK:c.topK,topP:c.topP,maxOutputTokens:c.maxOutputTokens}}),console.log("\u2705 Servi\xE7o Gemini inicializado")}async verifyConnection(){try{console.log("Verificando conex\xE3o com Gemini...");let s=await(await this.model.generateContent("Teste de conex\xE3o")).response;return console.log("\u2705 Conex\xE3o com Gemini estabelecida"),!0}catch(o){return console.error("\u274C Erro ao conectar com Gemini:",o),!1}}async generateResponse(o){try{console.log("Gerando resposta para:",o);let n=(await(await this.model.generateContent(o)).response).text();return console.log("Resposta gerada:",n),n}catch(s){throw console.error("Erro ao gerar resposta:",s),new Error("Falha ao gerar resposta com Gemini")}}};var g=class{isGroupMessage(o){return o.endsWith("@g.us")}isAuthorized(o){return this.isGroupMessage(o)?(console.log("Mensagem ignorada - \xE9 de um grupo"),!1):i.isDevelopment?this.isAdmin(o):!0}isAdmin(o){let s=o.replace(/[^0-9]/g,""),t=i.adminNumber.replace(/[^0-9]/g,"");return console.log("Comparando n\xFAmeros:"),console.log("N\xFAmero recebido:",s),console.log("N\xFAmero admin:",t),s===t}};var d=class{constructor(){this.auth=new g,console.log("\u2705 Manipulador de mensagens inicializado")}isBotMessage(o){return o.startsWith(l)}async handleMessage(o,s){try{console.log(`
=== Nova Mensagem Recebida ===`),console.log("De:",o.from),console.log("Conte\xFAdo:",o.body),console.log("\xC9 do bot:",this.isBotMessage(o.body)),console.log("Obtendo informa\xE7\xF5es do chat...");let t=await o.getChat(),n=t.isGroup;if(console.log("\xC9 grupo:",n),console.log("\xC9 autorizado:",this.auth.isAuthorized(o.from)),console.log("\xC9 admin:",this.auth.isAdmin(o.from)),console.log(`==============================
`),n){console.log("Ignorando mensagem de grupo");return}if(this.isBotMessage(o.body)){console.log("Ignorando mensagem do bot");return}if(!this.auth.isAuthorized(o.from)){console.log("Mensagem ignorada - n\xFAmero n\xE3o autorizado");return}if(this.auth.isAdmin(o.from)||s.config.isDevelopment){console.log("Processando mensagem...");try{console.log("Gerando resposta com Gemini...");let r=await s.gemini.generateResponse(o.body);console.log("Resposta gerada:",r),console.log("Tentando enviar mensagem para:",o.from),console.log("Chat obtido:",t.id);let a=l+r;console.log("Enviando mensagem:",a),await t.sendMessage(a),console.log("\u2705 Mensagem enviada com sucesso")}catch(r){console.error("\u274C Erro ao processar/enviar mensagem:",r);try{let a=l+"Desculpe, ocorreu um erro ao processar sua mensagem. Por favor, tente novamente.";console.log("Enviando mensagem de erro:",a),await t.sendMessage(a),console.log("\u2705 Mensagem de erro enviada com sucesso")}catch(a){console.error("Erro ao enviar mensagem de erro:",a)}}}else console.log("Mensagem ignorada - n\xE3o \xE9 do admin e n\xE3o est\xE1 em modo de desenvolvimento")}catch(t){console.error("\u274C Erro geral ao processar mensagem:",t);try{if(this.auth.isAdmin(o.from)){let n=await o.getChat(),r=l+"Desculpe, ocorreu um erro ao processar sua mensagem. Por favor, tente novamente.";console.log("Enviando mensagem de erro:",r),await n.sendMessage(r),console.log("\u2705 Mensagem de erro enviada com sucesso")}}catch(n){console.error("Erro ao enviar mensagem de erro:",n)}}}};async function y(){try{console.log("\u{1F680} Iniciando bot...");let e=new p.Client({authStrategy:new p.LocalAuth,puppeteer:{args:["--no-sandbox","--disable-setuid-sandbox","--disable-dev-shm-usage","--disable-accelerated-2d-canvas","--no-first-run","--no-zygote","--disable-gpu"],headless:!0}});console.log("Verificando conex\xE3o com Gemini...");let o=new m;if(!await o.verifyConnection())throw new Error("Falha ao conectar com Gemini");console.log("\u2705 Conex\xE3o com Gemini estabelecida");let t=new d,n={client:e,gemini:o,config:i};e.on("qr",r=>{console.log("QR Code recebido, escaneie com seu WhatsApp:"),M.default.generate(r,{small:!0})}),e.on("authenticated",()=>{console.log("\u2705 Autenticado com sucesso!")}),e.on("ready",()=>{console.log("\u2705 Cliente WhatsApp pronto para receber mensagens!")}),e.on("disconnected",r=>{console.log("\u274C Cliente desconectado:",r)}),e.on("message",async r=>{try{console.log(`
\u{1F4E8} Nova mensagem recebida`),await t.handleMessage(r,n)}catch(a){console.error("\u274C Erro ao processar mensagem:",a)}}),e.on("auth_failure",r=>{console.error("\u274C Falha na autentica\xE7\xE3o:",r)}),e.on("error",r=>{console.error("\u274C Erro no cliente WhatsApp:",r)}),console.log("Inicializando cliente WhatsApp..."),await e.initialize(),console.log("\u2705 Bot iniciado com sucesso!")}catch(e){console.error("\u274C Erro ao iniciar bot:",e),process.exit(1)}}y();
